# AI Context Configuration
# This file provides structured context to AI coding tools
# Integrates with self-learning superprompt infrastructure

version: '2.0'
updated: '2025-12-02'

# =============================================================================
# SUPERPROMPT SYSTEM (Self-Learning AI Infrastructure)
# =============================================================================
superprompts:
  engine: .config/ai/prompt-engine/engine.py
  selector: .config/ai/prompt-engine/selector.yaml
  orchestration: .config/ai/prompt-engine/orchestration-integration.yaml

  # Available superprompts
  library:
    codebase-sentinel:
      path: .config/ai/superprompts/codebase-sentinel.yaml
      triggers: [audit, cleanup, refactor, governance, quality]
      role: 'Systematic codebase quality maintenance'

    security-auditor:
      path: .config/ai/superprompts/security-auditor.yaml
      triggers: [security, vulnerability, audit, secrets, auth]
      role: 'Security-first code analysis'

    architect:
      path: .config/ai/superprompts/architect.yaml
      triggers: [design, architecture, system, scale, pattern]
      role: 'High-level system design'

    meta-orchestration-master:
      path: .config/ai/superprompts/meta-orchestration-master.yaml
      triggers: [orchestrate, coordinate, multi-agent, governance, compliance, checkpoint, handoff, mcp]
      role: 'Supreme AI Governance & Orchestration Controller'

  # Learning system
  learning:
    tracker: .config/ai/learning/effectiveness-tracker.yaml
    data_dir: .config/ai/learning/data/
    feedback_enabled: true

# =============================================================================
# AGENTS, WORKFLOWS & ORCHESTRATION
# =============================================================================
agents:
  registry: .config/ai/agents/config/agents.yaml
  templates: .config/ai/agents/templates/

workflows:
  registry: .config/ai/workflows/config/workflows.yaml
  templates: .config/ai/workflows/templates/

orchestration:
  config: .config/ai/orchestration/config/orchestration.yaml
  patterns: .config/ai/orchestration/patterns/

scripts:
  directory: .config/ai/scripts/

# =============================================================================
# CORE DOCUMENTATION
# =============================================================================
documentation:
  codemap: docs/CODEMAP.md
  architecture: docs/ARCHITECTURE.md
  ai_orchestration: docs/AI_ORCHESTRATION.md
  framework: docs/FRAMEWORK.md

# =============================================================================
# GOVERNANCE POLICIES
# =============================================================================
policies:
  protected_files: .metaHub/policies/protected-files.yaml
  root_structure: .metaHub/policies/root-structure.yaml
  orchestration: .metaHub/policies/orchestration-governance.yaml
  ai_instructions: CLAUDE.md

# =============================================================================
# TOOLS AND ENTRY POINTS
# =============================================================================
tools:
  # Prompt Engine
  prompt_select: 'python .config/ai/prompt-engine/engine.py select'
  prompt_report: 'python .config/ai/prompt-engine/engine.py report'

  # Orchestration
  orchestrator: automation/orchestration/codebase_orchestrator.py
  ORCHEX: tools/ORCHEX/

  # CLI
  devops_cli: tools/cli/devops.ts
  governance_cli: tools/cli/governance.py

# =============================================================================
# TRACKING AND METRICS
# =============================================================================
tracking:
  task_history: .config/ai/task-history.json
  recent_changes: .config/ai/recent-changes.json
  metrics: .config/ai/metrics.json
  current_task: .config/ai/current-task.json
  prompt_stats: .config/ai/learning/data/prompt-stats.json

# =============================================================================
# FEEDBACK AND LEARNING
# =============================================================================
feedback:
  directory: .config/ai/feedback/
  pr_comments: .config/ai/feedback/pr-comments.json
  task_outcomes: .config/ai/feedback/task-outcomes.json
  suggestions: .config/ai/feedback/suggestions.json
  prompt_effectiveness: .config/ai/learning/data/task-history.jsonl

# =============================================================================
# AI ROUTING (Enhanced with Superprompts)
# =============================================================================
routing:
  # Route by task type to superprompt + tool combination
  task_routing:
    audit:
      superprompt: codebase-sentinel
      tool: claude
    security:
      superprompt: security-auditor
      tool: claude
    architecture:
      superprompt: architect
      tool: claude
    refactoring:
      superprompt: codebase-sentinel
      tool: kilo
    quick_fixes:
      superprompt: null # No superprompt needed
      tool: copilot
    code_review:
      superprompt: [codebase-sentinel, security-auditor]
      tool: claude

  # Fallback routing
  default:
    superprompt: codebase-sentinel
    tool: claude

# =============================================================================
# MODEL TIERING (Token Optimization)
# =============================================================================
model_tiering:
  config: .config/ai/model-tiering.yaml
  enabled: true

  # Default tier selection
  default_tier: standard

  # Tier overrides by task type
  task_tier_mapping:
    quick_fixes: lightweight
    code_completion: lightweight
    formatting: lightweight
    refactoring: standard
    documentation: standard
    unit_testing: standard
    code_review: standard
    architecture: heavyweight
    security_audit: heavyweight
    codebase_analysis: heavyweight
    complex_debugging: heavyweight

# =============================================================================
# CONTEXT INJECTION (Token-Optimized)
# =============================================================================
injection:
  # Use retrieval-first mode instead of loading full files
  retrieval_first:
    enabled: true
    max_results: 10
    prefer_snippets: true
    fallback_to_full: false

  # Summarize large files instead of loading full content
  summarization:
    enabled: true
    threshold_lines: 200  # Summarize files over 200 lines
    preserve_signatures: true

  # Priority-based loading (higher priority = loaded first)
  priority_loading:
    enabled: true
    budget_percentage: 0.6  # Use 60% of tier budget for context

  always_include:
    - path: docs/CODEMAP.md
      priority: 90
      mode: summary  # Load summary, not full file
    - path: CLAUDE.md
      priority: 100
      mode: full     # Always load full (it's small)

  include_on_audit:
    - path: .config/ai/superprompts/codebase-sentinel.yaml
      priority: 85
      mode: full
    - path: .metaHub/policies/root-structure.yaml
      priority: 70
      mode: summary

  include_on_security:
    - path: .config/ai/superprompts/security-auditor.yaml
      priority: 85
      mode: full
    - path: .metaHub/policies/protected-files.yaml
      priority: 80
      mode: full

  include_on_feature:
    - path: docs/ARCHITECTURE.md
      priority: 75
      mode: summary
    - path: .config/ai/superprompts/architect.yaml
      priority: 85
      mode: full

# =============================================================================
# TOKEN TRACKING
# =============================================================================
token_tracking:
  enabled: true
  log_file: .config/ai/logs/token-usage.jsonl

  # Alert thresholds
  alerts:
    session_budget: 50000   # Warn if session exceeds 50K tokens
    daily_budget: 500000    # Warn if daily usage exceeds 500K tokens
    cost_threshold: 5.00    # Alert if daily cost exceeds $5

  # Metrics to track
  metrics:
    - tokens_per_task
    - tokens_per_file
    - tier_distribution
    - compression_savings
    - retrieval_hit_rate

# =============================================================================
# SYNC AND AUTOMATION
# =============================================================================
sync:
  on_pr_merge: true
  on_release: true
  on_governance_change: true
  schedule: daily
  update_prompt_stats: true
  update_token_metrics: true
