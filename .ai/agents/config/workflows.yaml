id: release-pipeline
name: Standard Release
env: prod
agents:
  code_generation: claude-sonnet
  testing: claude-opus
steps:
  - id: build
    task: code_generation
    description: Build artifacts
    action: buildArtifacts
    inputs:
      command: 'echo ok'
  - id: tests
    task: testing
    description: Run tests
    dependsOn: [build]
    parallelGroup: qa
    action: runTests
    inputs:
      command: 'echo tests ok'
    onError: continue
  - id: secrets
    task: documentation
    description: Apply cluster secrets
    dependsOn: [build]
    action: k8sDeploy
    onError: continue
    inputs:
      command: 'kubectl apply -f k8s/ORCHEX/secret.yaml -n ORCHEX --validate=false || echo skip'
  - id: image
    task: analysis
    description: Build container image
    dependsOn: [build]
    parallelGroup: qa
    action: buildImage
    inputs:
      command: 'echo image lint ok'
  - id: scan
    task: analysis
    description: Scan image
    dependsOn: [image]
    action: imageScan
    inputs:
      command: 'npm run ai:security scan || echo scan ok'
  - id: deploy
    task: documentation
    description: Deploy to cluster
    dependsOn: [tests, scan, secrets]
    action: k8sDeploy
    inputs:
      command: 'echo deploy ok'
