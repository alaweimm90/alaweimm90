version: '3.9'

services:
  supertool:
    build:
      context: ../..
      dockerfile: devops/docker/Dockerfile
    image: supertool:latest
    container_name: supertool-cli
    environment:
      - NODE_ENV=production
    volumes:
      # Mount local directories for development
      - ../../cli:/app:ro
      # Mount output directory for generated files
      - ../../outputs:/outputs
    networks:
      - supertool-network
    restart: unless-stopped
    command: ["--help"]

  # Development service with hot reload
  supertool-dev:
    build:
      context: ../..
      dockerfile: devops/docker/Dockerfile.dev
    image: supertool:dev
    container_name: supertool-dev
    environment:
      - NODE_ENV=development
      - DEBUG=*
    volumes:
      # Mount entire CLI for development with write access
      - ../../cli:/app
      - ../../outputs:/outputs
      # Exclude node_modules to use container's version
      - /app/node_modules
    networks:
      - supertool-network
    restart: unless-stopped
    stdin_open: true
    tty: true
    command: ["/bin/sh"]

networks:
  supertool-network:
    driver: bridge
    name: supertool-net

volumes:
  supertool-data:
    name: supertool-data
