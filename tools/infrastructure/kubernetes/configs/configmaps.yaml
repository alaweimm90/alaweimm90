---
# SuperTool Application Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: supertool-config
  namespace: production
  labels:
    app.kubernetes.io/name: supertool
    app.kubernetes.io/instance: supertool-production
    app.kubernetes.io/component: config
data:
  # Application settings
  NODE_ENV: "production"
  LOG_LEVEL: "info"
  PORT: "3000"

  # Feature flags
  ENABLE_METRICS: "true"
  ENABLE_TRACING: "true"
  ENABLE_PROFILING: "false"

  # Performance tuning
  MAX_WORKERS: "4"
  WORKER_TIMEOUT: "30000"
  REQUEST_TIMEOUT: "60000"

  # Cache settings
  CACHE_TTL: "3600"
  CACHE_MAX_SIZE: "1000"

  # Rate limiting
  RATE_LIMIT_WINDOW: "60000"
  RATE_LIMIT_MAX_REQUESTS: "100"

  # Database settings (non-sensitive)
  DB_POOL_MIN: "2"
  DB_POOL_MAX: "10"
  DB_CONNECTION_TIMEOUT: "5000"

  # Application config file
  app-config.json: |
    {
      "application": {
        "name": "SuperTool",
        "version": "1.0.0",
        "environment": "production"
      },
      "server": {
        "port": 3000,
        "host": "0.0.0.0",
        "cors": {
          "enabled": true,
          "origins": ["https://supertool.example.com"]
        }
      },
      "logging": {
        "level": "info",
        "format": "json",
        "output": "stdout"
      },
      "monitoring": {
        "prometheus": {
          "enabled": true,
          "port": 9090,
          "path": "/metrics"
        },
        "healthCheck": {
          "enabled": true,
          "path": "/health"
        }
      }
    }

---
# SuperTool Feature Flags
apiVersion: v1
kind: ConfigMap
metadata:
  name: supertool-feature-flags
  namespace: production
  labels:
    app.kubernetes.io/name: supertool
    app.kubernetes.io/component: feature-flags
data:
  # Feature toggles
  FEATURE_NEW_UI: "true"
  FEATURE_ADVANCED_ANALYTICS: "true"
  FEATURE_BETA_API: "false"
  FEATURE_EXPERIMENTAL_MODE: "false"

  # A/B Testing
  AB_TEST_NEW_DASHBOARD: "50"  # 50% of users
  AB_TEST_NEW_WORKFLOW: "25"    # 25% of users

---
# SuperTool Logging Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: supertool-logging-config
  namespace: production
  labels:
    app.kubernetes.io/name: supertool
    app.kubernetes.io/component: logging
data:
  log4j2.xml: |
    <?xml version="1.0" encoding="UTF-8"?>
    <Configuration status="WARN">
      <Appenders>
        <Console name="Console" target="SYSTEM_OUT">
          <PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n"/>
        </Console>
        <File name="File" fileName="/var/log/supertool/app.log">
          <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss} %-5p %c{1}:%L - %m%n"/>
        </File>
      </Appenders>
      <Loggers>
        <Root level="info">
          <AppenderRef ref="Console"/>
          <AppenderRef ref="File"/>
        </Root>
      </Loggers>
    </Configuration>

---
# SuperTool Nginx Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: supertool-nginx-config
  namespace: production
  labels:
    app.kubernetes.io/name: supertool
    app.kubernetes.io/component: nginx
data:
  nginx.conf: |
    user nginx;
    worker_processes auto;
    error_log /var/log/nginx/error.log warn;
    pid /var/run/nginx.pid;

    events {
        worker_connections 1024;
    }

    http {
        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                        '$status $body_bytes_sent "$http_referer" '
                        '"$http_user_agent" "$http_x_forwarded_for"';

        access_log /var/log/nginx/access.log main;

        sendfile on;
        tcp_nopush on;
        tcp_nodelay on;
        keepalive_timeout 65;
        types_hash_max_size 2048;

        gzip on;
        gzip_disable "msie6";
        gzip_vary on;
        gzip_proxied any;
        gzip_comp_level 6;
        gzip_types text/plain text/css text/xml text/javascript
                   application/json application/javascript application/xml+rss;

        upstream backend {
            server supertool-service:3000;
            keepalive 32;
        }

        server {
            listen 80;
            server_name _;

            location /health {
                access_log off;
                return 200 "healthy\n";
                add_header Content-Type text/plain;
            }

            location / {
                proxy_pass http://backend;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_http_version 1.1;
                proxy_set_header Connection "";
            }
        }
    }

---
# SuperTool Prometheus Scrape Config
apiVersion: v1
kind: ConfigMap
metadata:
  name: supertool-prometheus-config
  namespace: production
  labels:
    app.kubernetes.io/name: supertool
    app.kubernetes.io/component: monitoring
data:
  prometheus.yml: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    scrape_configs:
      - job_name: 'supertool'
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - production
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_name]
            action: keep
            regex: supertool
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
            action: replace
            regex: ([^:]+)(?::\d+)?;(\d+)
            replacement: $1:$2
            target_label: __address__

---
# SuperTool Environment-Specific Config (Staging)
apiVersion: v1
kind: ConfigMap
metadata:
  name: supertool-config
  namespace: staging
  labels:
    app.kubernetes.io/name: supertool
    app.kubernetes.io/instance: supertool-staging
    environment: staging
data:
  NODE_ENV: "staging"
  LOG_LEVEL: "debug"
  PORT: "3000"
  ENABLE_METRICS: "true"
  ENABLE_TRACING: "true"
  ENABLE_PROFILING: "true"
  MAX_WORKERS: "2"
  CACHE_TTL: "1800"

---
# SuperTool Environment-Specific Config (Dev)
apiVersion: v1
kind: ConfigMap
metadata:
  name: supertool-config
  namespace: dev
  labels:
    app.kubernetes.io/name: supertool
    app.kubernetes.io/instance: supertool-dev
    environment: development
data:
  NODE_ENV: "development"
  LOG_LEVEL: "debug"
  PORT: "3000"
  ENABLE_METRICS: "false"
  ENABLE_TRACING: "false"
  ENABLE_PROFILING: "true"
  MAX_WORKERS: "1"
  CACHE_TTL: "300"
