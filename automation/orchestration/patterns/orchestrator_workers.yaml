# Orchestrator-Workers Pattern
# Central LLM dynamically delegates to specialized workers

name: 'orchestrator_workers'
description: |
  A central orchestrator LLM analyzes the task, breaks it down dynamically,
  and delegates subtasks to specialized worker agents. The orchestrator
  synthesizes results and may iterate based on findings.

# When to use this pattern
use_when:
  - 'Complex tasks requiring different expertise'
  - 'Subtasks are not predictable in advance'
  - 'Need dynamic decision-making during execution'
  - 'Task requires coordination between specialists'

# When NOT to use
avoid_when:
  - 'Task is simple and predictable'
  - 'Fixed workflow is sufficient'
  - 'Low latency is critical'

# Pattern structure
structure:
  type: 'hierarchical'
  components:
    - 'input'
    - 'orchestrator'
    - 'dynamic_delegation'
    - 'workers[]'
    - 'synthesis'
    - 'output'

# Orchestrator responsibilities
orchestrator:
  responsibilities:
    - 'Analyze incoming task'
    - 'Decompose into subtasks'
    - 'Select appropriate workers'
    - 'Delegate with clear instructions'
    - 'Monitor progress'
    - 'Synthesize results'
    - 'Iterate if needed'

  decision_points:
    - 'Which workers to engage'
    - 'Order of subtasks'
    - 'When to iterate'
    - 'When task is complete'

# Worker types
worker_types:
  specialist:
    description: 'Expert in specific domain'
    examples:
      - 'security_expert'
      - 'performance_optimizer'
      - 'documentation_writer'

  generalist:
    description: 'Can handle various tasks'
    examples:
      - 'coder_agent'
      - 'reviewer_agent'

  tool_user:
    description: 'Specialized in using specific tools'
    examples:
      - 'search_agent'
      - 'analysis_agent'

# Example implementation
example:
  name: 'complex_refactoring'

  orchestrator:
    agent: 'architect_agent'
    initial_prompt: |
      Analyze this codebase for refactoring opportunities.
      You have access to these specialists:
      - code_analyzer: Static analysis and metrics
      - security_expert: Security review
      - performance_expert: Performance optimization
      - refactoring_agent: Code transformation

      Break down the task and delegate appropriately.

  workers:
    - name: 'code_analyzer'
      agent: 'reviewer_agent'
      capabilities: ['static_analysis', 'metrics', 'complexity']

    - name: 'security_expert'
      agent: 'security_agent'
      capabilities: ['vulnerability_scan', 'best_practices']

    - name: 'performance_expert'
      agent: 'performance_agent'
      capabilities: ['profiling', 'optimization']

    - name: 'refactoring_agent'
      agent: 'coder_agent'
      capabilities: ['code_transformation', 'testing']

  synthesis:
    method: 'orchestrator_summary'
    include_worker_outputs: true

# Communication protocol
communication:
  delegation_format:
    task_id: 'unique_id'
    worker: 'worker_name'
    instruction: 'Clear task description'
    context: 'Relevant context from previous steps'
    expected_output: 'What to return'
    timeout: 'minutes'

  response_format:
    task_id: 'matching_id'
    status: 'success|failure|partial'
    output: 'Task result'
    confidence: '0.0-1.0'
    notes: 'Any observations'

# Best practices
best_practices:
  - 'Give orchestrator clear overview of available workers'
  - 'Define worker capabilities explicitly'
  - 'Include context in delegations'
  - 'Set iteration limits to prevent loops'
  - 'Log all delegations for debugging'
  - 'Allow orchestrator to ask clarifying questions'

# Template
template: |
  orchestrator:
    agent: "{{orchestrator_agent}}"
    prompt: |
      {{orchestrator_prompt}}

    available_workers:
      {{#each workers}}
      - name: "{{name}}"
        capabilities: [{{capabilities}}]
      {{/each}}

    max_iterations: {{max_iterations}}

  workers:
    {{#each workers}}
    - name: "{{name}}"
      agent: "{{agent}}"
      capabilities: [{{capabilities}}]
      timeout_minutes: {{timeout}}
    {{/each}}

  synthesis:
    agent: "{{orchestrator_agent}}"
    method: "{{synthesis_method}}"
