openapi: 3.1.0
info:
  title: Meta-Orchestration Master API
  description: |
    REST API for AI governance, compliance, security, and orchestration tools.

    ## Authentication
    Protected endpoints require an API key via:
    - `Authorization: Bearer <api-key>` header
    - `X-API-Key: <api-key>` header

    ## Rate Limiting
    - 100 requests per minute per IP (configurable via `RATE_LIMIT_MAX`)
    - Rate limit headers: `X-RateLimit-Limit`, `X-RateLimit-Remaining`, `X-RateLimit-Reset`
  version: 1.0.0
  contact:
    name: Meta-Orchestration Master
    url: https://github.com/alawein/alawein
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3200
    description: Local development server

tags:
  - name: Health
    description: Service health and status
  - name: Compliance
    description: Code compliance checking
  - name: Security
    description: Security scanning
  - name: Cache
    description: Cache management
  - name: Monitor
    description: System monitoring
  - name: Errors
    description: Error tracking
  - name: Issues
    description: Issue management
  - name: Metrics
    description: Performance metrics
  - name: Tasks
    description: Task management
  - name: Dashboard
    description: Visual dashboard

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: API key as Bearer token
    apiKeyHeader:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key in custom header

  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        error:
          type: string
        timestamp:
          type: string
          format: date-time

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        uptime:
          type: number
        dependencies:
          type: object
          properties:
            mcp:
              type: object
            cache:
              type: object
            filesystem:
              type: object

    ComplianceReport:
      type: object
      properties:
        score:
          type: number
          minimum: 0
          maximum: 100
        violations:
          type: array
          items:
            type: object
        checkedAt:
          type: string
          format: date-time

    SecurityReport:
      type: object
      properties:
        secrets:
          type: integer
        vulnerabilities:
          type: integer
        licenses:
          type: array
        scannedAt:
          type: string
          format: date-time

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
        timestamp:
          type: string
          format: date-time

  responses:
    Unauthorized:
      description: Missing or invalid API key
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    RateLimited:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

security:
  - bearerAuth: []
  - apiKeyHeader: []

paths:
  /health:
    get:
      tags: [Health]
      summary: Get service health status
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /health/dependencies:
    get:
      tags: [Health]
      summary: Check all dependency health
      security: []
      responses:
        '200':
          description: Dependency status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /compliance/score:
    get:
      tags: [Compliance]
      summary: Get current compliance score
      responses:
        '200':
          description: Compliance report
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceReport'
        '404':
          $ref: '#/components/responses/NotFound'

  /compliance/check:
    post:
      tags: [Compliance]
      summary: Run compliance check on files
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                  description: Files to check (empty for all)
      responses:
        '200':
          description: Compliance check results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ComplianceReport'

  /compliance/rules:
    get:
      tags: [Compliance]
      summary: List compliance rules
      responses:
        '200':
          description: List of rules
          content:
            application/json:
              schema:
                type: object
                properties:
                  rules:
                    type: string

  /security/report:
    get:
      tags: [Security]
      summary: Get latest security report
      responses:
        '200':
          description: Security scan results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecurityReport'
        '404':
          $ref: '#/components/responses/NotFound'

  /security/scan:
    post:
      tags: [Security]
      summary: Run security scan
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [scan, secrets, vulnerabilities]
                  default: scan
      responses:
        '200':
          description: Security scan results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SecurityReport'

  /cache/stats:
    get:
      tags: [Cache]
      summary: Get cache statistics
      responses:
        '200':
          description: Cache statistics

  /cache:
    delete:
      tags: [Cache]
      summary: Clear cache
      parameters:
        - name: layer
          in: query
          schema:
            type: string
            enum: [memory, file, all]
      responses:
        '200':
          description: Cache cleared

  /metrics:
    get:
      tags: [Metrics]
      summary: Get AI metrics
      responses:
        '200':
          description: Metrics data

  /metrics/prometheus:
    get:
      tags: [Metrics]
      summary: Get Prometheus-format metrics
      security: []
      responses:
        '200':
          description: Prometheus metrics
          content:
            text/plain:
              schema:
                type: string

  /dashboard:
    get:
      tags: [Dashboard]
      summary: Get dashboard data (JSON)
      responses:
        '200':
          description: Dashboard metrics

  /dashboard/ui:
    get:
      tags: [Dashboard]
      summary: Visual dashboard (HTML)
      security: []
      responses:
        '200':
          description: HTML dashboard
          content:
            text/html:
              schema:
                type: string

  /tasks/history:
    get:
      tags: [Tasks]
      summary: Get task history
      responses:
        '200':
          description: Task history

  /tasks/start:
    post:
      tags: [Tasks]
      summary: Start a new task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                tags:
                  type: array
                  items:
                    type: string
                description:
                  type: string
      responses:
        '200':
          description: Task started

  /tasks/complete:
    post:
      tags: [Tasks]
      summary: Complete current task
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                success:
                  type: boolean
                notes:
                  type: string
      responses:
        '200':
          description: Task completed

  /errors:
    get:
      tags: [Errors]
      summary: List recent errors
      parameters:
        - name: severity
          in: query
          schema:
            type: string
            enum: [error, warning, info]
      responses:
        '200':
          description: Error list

  /errors/stats:
    get:
      tags: [Errors]
      summary: Get error statistics
      responses:
        '200':
          description: Error statistics

  /issues:
    get:
      tags: [Issues]
      summary: List tracked issues
      parameters:
        - name: status
          in: query
          schema:
            type: string
        - name: priority
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Issue list

  /issues/critical:
    get:
      tags: [Issues]
      summary: List critical issues
      responses:
        '200':
          description: Critical issues

  /issues/stats:
    get:
      tags: [Issues]
      summary: Get issue statistics
      responses:
        '200':
          description: Issue statistics

  /monitor/status:
    get:
      tags: [Monitor]
      summary: Get monitor status
      responses:
        '200':
          description: Monitor status

  /monitor/check:
    post:
      tags: [Monitor]
      summary: Run monitor check
      responses:
        '200':
          description: Check results

  /context:
    get:
      tags: [Tasks]
      summary: Get AI context
      parameters:
        - name: type
          in: query
          schema:
            type: string
      responses:
        '200':
          description: AI context

  /sync:
    post:
      tags: [Tasks]
      summary: Synchronize AI context
      responses:
        '200':
          description: Sync results

  /telemetry/status:
    get:
      tags: [Monitor]
      summary: Get telemetry status
      responses:
        '200':
          description: Telemetry status

  /telemetry/alerts:
    get:
      tags: [Monitor]
      summary: Get telemetry alerts
      responses:
        '200':
          description: Alerts list

